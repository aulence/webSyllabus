"use strict";function addMemoire(){$("#addMemoire").click(function(a){$("edit-page").css("display","block").animate({left:"0%"},300),$(a.currentTarget).is("#addMemoire")&&$("#memoireContent").prop("readonly",!1)}),$("#backMainPage").click(function(){var a=$("edit-page");a.animate({left:"100%"},300,function(){a.css("display","none"),$("#memoireContent").val("")})})}function editCtrl(){$("#editList").click(function(){$(this).css("display","none"),$("#cancelEdit").css("display","block"),$("#addMemoire").css("display","none"),$("#deleteCkdItem").css("display","block");var b=0==$(this).prop("disabled");if(b){var a=$("#memoireList li");a.children("div").animate({width:"48px"},200),a.children("p").animate({marginLeft:"36px"},200),a.addClass("disabled")}$("header h1").text("已选中0项")}),$("#cancelEdit").click(function(){$(this).css("display","none"),$("#editList").css("display","block"),$("#addMemoire").css("display","block"),$("#deleteCkdItem").css("display","none");var a=$("#memoireList li");a.children("div").animate({width:"0px"},200),a.children("p").animate({marginLeft:"0px"},200),$("header h1").text("备忘录"),$("#memoireList i.ckd").removeClass("ckd"),a.removeClass("disabled")})}function markListItem(){$("#memoireList").on("click","li > div",function(h){var j,d=$(this).children("i"),c=d.hasClass("ckd"),b=$(this).parent().index(),g=localStorage.getItem("memoireData"),k=JSON.parse(g);c?(d.removeClass("ckd"),k[b].deleteStatus=!1,j=k):(d.addClass("ckd"),k[b].deleteStatus=!0,j=k),j=JSON.stringify(j),localStorage.setItem("memoireData",j);var f=$("#memoireList i.ckd").length;$("header h1").text("已选中"+f+"项")})}function removeMarkListItem(){$("#deleteCkdItem").click(function(){for(var g,h=$("i.ckd").closest("li"),d=localStorage.getItem("memoireData"),c=JSON.parse(d),b=c.length,k=0,j=0;b>j;j++){c[j].deleteStatus&&k++}for(;k;){b=c.length;for(var f=0;b>f;f++){if(c[f].deleteStatus){c.splice(f,1),k--;break}}}g=c,g=JSON.stringify(g),localStorage.setItem("memoireData",g),h.remove(),$("#cancelEdit").trigger("click"),setEditBtnStatus()})}function setSaveBtnStatus(){var a=$("#saveMemoire");$("#memoireContent").keyup(function(){var d=$(this).val(),c=""!==d,b=!/^\s+$/.test(d);c&&b?a.prop("disabled",!1):a.prop("disabled",!0)})}function saveMemoireData(){$("#saveMemoire").click(function(){function h(){var t=$("#memoireContent").val(),m=new Date,k=m.getFullYear(),q=m.getMonth()+1,v=m.getDate(),u=m.getHours(),p=m.getMinutes();q=1===String(q).length?"0"+q:q,v=1===String(v).length?"0"+v:v,u=1===String(u).length?"0"+u:u,p=1===String(p).length?"0"+p:p;var j=k+"-"+q+"-"+v+" "+u+":"+p;d={content:t,saveDate:j,deleteStatus:!1}}var g=$("#memoireContent").val();if(""!=g&&!/^\s+$/.test(g)){var d,c=null!==localStorage.getItem("memoireData");if(c){h();var b=localStorage.getItem("memoireData");if(b=JSON.parse(b),GLOBAL.editing){b.splice(GLOBAL.itemIndex,1,d);var f=$("#memoireList li").eq(GLOBAL.itemIndex);f.children("p:first").text(b[GLOBAL.itemIndex].content),f.children("p:last").text(b[GLOBAL.itemIndex].saveDate),b=JSON.stringify(b),localStorage.setItem("memoireData",b),$("#memoireContent").val(""),$("#backMainPage").trigger("click"),$("#saveMemoire").prop("disabled",!0),GLOBAL.editing=!1,GLOBAL.itemIndex=NaN}else{b.push(d),b=JSON.stringify(b),localStorage.setItem("memoireData",b),locationDataCtrl()}}else{h(),d=JSON.stringify(d),localStorage.setItem("memoireData","["+d+"]"),locationDataCtrl()}}})}function loadMemoireList(){var d=null!==localStorage.getItem("memoireData");if(d){var c=localStorage.getItem("memoireData");c=JSON.parse(c);var b=(c.length,$("#memoireList"));$.each(c,function(f,a){b.append("\n				<li>\n					<div>\n						<i>√</i>\n					</div>\n					<p>"+a.content+"</p>\n					<p>"+a.saveDate+"</p>\n				</li>\n			")}),setEditBtnStatus()}}function setEditBtnStatus(){var b=$("#memoireList")[0].childElementCount,a=$("#editList");0===b?(a.prop("disabled",!0),$("footer h2").text("无备忘录")):(a.prop("disabled",!1),$("footer h2").text(b+"个备忘录"))}function toMemoireEditPage(){$("#memoireList").on("click","li",function(f){var d=$(f.target);if(!d.is("i")&&!d.is("div")&&!$(this).hasClass("disabled")){var c=$(this).index(),b=localStorage.getItem("memoireData");b=JSON.parse(b),$("#memoireContent").val(b[c].content).prop("readonly",!0),GLOBAL.editing=!0,GLOBAL.itemIndex=c,$("#addMemoire").trigger("click")}})}function activeEditor(){$("#enableEdit").click(function(){var a=$("#memoireContent").val();""==a||/^\s+$/.test(a)||($("#memoireContent").prop("readonly",!1).focus(),$("#saveMemoire").prop("disabled",!1))})}function locationDataCtrl(){setTimeout(function(){var b=localStorage.getItem("memoireData");b=JSON.parse(b);var a=b.length;$("#memoireList").append("\n						<li>\n							<div>\n								<i>√</i>\n							</div>\n							<p>"+b[a-1].content+"</p>\n							<p>"+b[a-1].saveDate+"</p>\n						</li>\n					"),$("#memoireContent").val(""),$("#backMainPage").trigger("click"),$("#saveMemoire").prop("disabled",!0),setEditBtnStatus()},100)}var GLOBAL={editing:!1,itemIndex:NaN};$(function(){addMemoire(),editCtrl(),markListItem(),removeMarkListItem(),setSaveBtnStatus(),saveMemoireData(),loadMemoireList(),setEditBtnStatus(),toMemoireEditPage(),activeEditor()});